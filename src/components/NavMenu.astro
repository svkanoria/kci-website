---
import { mapPageLinks, PageLink, removeTrailingSlash } from "../utils";
import NavGroupTitle from "./NavGroupTitle.astro";

interface Props {
  pageLinks: Record<string, PageLink[]>;
  isCompact?: boolean;
}

const { pageLinks, isCompact } = Astro.props;

const currentPath = new URL(Astro.request.url).pathname;
---

<ul class:list={["menu", { "menu-compact": isCompact }]}>
  {
    mapPageLinks(
      (links, group) => (
        <>
          <NavGroupTitle group={group} />
          {links.map((link) => (
            <li>
              <a
                href={link.href}
                class={
                  removeTrailingSlash(currentPath) ===
                  removeTrailingSlash(link.href)
                    ? "active"
                    : ""
                }
              >
                {isCompact ? (
                  <div class="flex">
                    <div class="shrink-0 mr-2 text-stone-400">&bull;</div>
                    <div>{link.title}</div>
                  </div>
                ) : (
                  link.title
                )}
              </a>
            </li>
          ))}
        </>
      ),
      pageLinks
    )
  }
</ul>
