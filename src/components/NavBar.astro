---
import { Resize } from "@cloudinary/url-gen/actions";
import { getPageLink, getPageLinks, mapPageLinks } from "../utils";
import CldImage from "./CldImage.astro";
import NavBarItem from "./navBar/NavBarItem.astro";
import NavBarMenu from "./navBar/NavBarMenu.astro";
import NavGroupTitle from "./NavGroupTitle.astro";

const aboutPageLink = await getPageLink(
  import.meta.glob("../pages/about/index.astro")
);

const aboutPageLinks = await getPageLinks(
  import.meta.glob("../pages/about/*.{astro,md,mdx,html}")
);

const productsPageLink = await getPageLink(
  import.meta.glob("../pages/products/index.astro")
);

const productPageLinks = await getPageLinks(
  import.meta.glob("../pages/products/*.{astro,md,mdx,html}")
);

const investorsPageLink = await getPageLink(
  import.meta.glob("../pages/investors/index.astro")
);

const investorsPageLinks = await getPageLinks(
  import.meta.glob("../pages/investors/*.{astro,md,mdx,html}")
);
---

<div class="drawer">
  <input id="main-nav" type="checkbox" class="drawer-toggle" />
  <div class="drawer-content flex flex-col">
    <!-- Navbar -->
    <div class="w-full navbar bg-base-300">
      <div class="navbar-start">
        <div class="flex-none lg:hidden">
          <label for="main-nav" class="btn btn-square btn-ghost">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              class="inline-block w-6 h-6 stroke-current"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              >
              </path>
            </svg>
          </label>
        </div>
        <div class="flex-1 px-2 mx-2">
          <a href="/">
            <CldImage
              src="kci-logo_syvn0a"
              width="200px"
              height="80px"
              alt="KCI logo"
              transform={(image) =>
                image.resize(Resize.fit().width(400).height(160))}
            />
          </a>
        </div>
      </div>
      <div class="navbar-center">
        <div class="flex-none hidden lg:block">
          <ul class="menu menu-horizontal">
            <li tabindex="0">
              <NavBarItem
                pageLink={aboutPageLink}
                className="justify-between"
                noHref
              />
              <NavBarMenu
                links={aboutPageLinks}
                overviewLinkHref={aboutPageLink.href}
              />
            </li>
            <li tabindex="0">
              <NavBarItem
                pageLink={productsPageLink}
                className="justify-between"
                noHref
              />
              <NavBarMenu
                links={productPageLinks}
                overviewLinkHref={productsPageLink.href}
              />
            </li>
            <li tabindex="0">
              <NavBarItem
                pageLink={investorsPageLink}
                className="justify-between"
                noHref
              />
              <NavBarMenu
                links={investorsPageLinks}
                overviewLinkHref={investorsPageLink.href}
              />
            </li>
          </ul>
        </div>
      </div>
      <div class="navbar-end"></div>
    </div>
    <!-- Page content here -->
    <slot />
  </div>
  <div class="drawer-side">
    <label for="main-nav" class="drawer-overlay"></label>
    <!-- `overflow-y-auto flex-nowrap` added 
      to fix Daisy unwanted scrollbar bug -->
    <ul class="menu w-80 p-4 bg-base-100 overflow-y-auto flex-nowrap">
      <li>
        <NavBarItem pageLink={aboutPageLink} />
      </li>
      <ul class="px-4">
        {
          mapPageLinks(
            (links, group) => (
              <>
                <NavGroupTitle group={group} />
                {links.map((link) => (
                  <li>
                    <NavBarItem pageLink={link} />
                  </li>
                ))}
              </>
            ),
            aboutPageLinks
          )
        }
      </ul>
      <li>
        <NavBarItem pageLink={productsPageLink} />
      </li>
      <ul class="px-4">
        {
          mapPageLinks(
            (links, group) => (
              <>
                <NavGroupTitle group={group} />
                {links.map((link) => (
                  <li>
                    <NavBarItem pageLink={link} />
                  </li>
                ))}
              </>
            ),
            productPageLinks
          )
        }
      </ul>
      <li>
        <NavBarItem pageLink={investorsPageLink} />
      </li>
      <ul class="px-4">
        {
          mapPageLinks(
            (links, group) => (
              <>
                <NavGroupTitle group={group} />
                {links.map((link) => (
                  <li>
                    <NavBarItem pageLink={link} />
                  </li>
                ))}
              </>
            ),
            investorsPageLinks
          )
        }
      </ul>
    </ul>
  </div>
</div>
